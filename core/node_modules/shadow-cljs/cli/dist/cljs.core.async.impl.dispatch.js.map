{"version":3,"file":"cljs.core.async.impl.dispatch.js","sources":["cljs/core/async/impl/dispatch.cljs"],"mappings":";;;;;;;;;;;;;AAIA,AAAKE,sCAAM,yCAAA,zCAACC;AACZ,+CAAA,/CAAKC;AACL,8CAAA,9CAAKH;AAEL,gDAAA,hDAAKY;AAIL,iDAAA,jDAAML,AAFN,AAAA;AAGE,+CAAA,/CAAMJ,AADR;;AAEE,8CAAA,9CAAMH;;AACN,kBAAA,dAAOD;;AAAP,AACE,IAAMW,UAAE,AAAMT;AACZ,GAAU,YAAA,XAAMS,JADlB;AACE;AAAA,AACE,CAACA,wCAAAA,0CAAAA;;AACD,GAAM,CAAGX,cAAMa;AACb,eAAO,eAAA,dAAKb,hBADd;;;;AAAA;;;;;AAEN,+CAAA,/CAAMI;;AACN,GAAM,8CAAA,7CAAG,AAAUF;AAAnB,AACE,QAACI,+EAAAA,iFAAAA;;AADH;;;AAGF,iDAAA,jDAAMA;AAAN,AACE,GAAU,CAAKL,iDAAQG;AAAvB;;AACE,8CAAA,9CAAMH,AADR;;AAEE,OAACM,oBAAoBC;;;AAEzB,oCAAA,pCAAMM,gFAAKT;AACT,AAAoBH,sDAAMG,tDAD5B;;AAEE,OAACC;;AAEH,4CAAA,5CAAMG,gGAAaJ,EAAEK;AAArB,AACE,OAACE,WAAcP,EAAEK","names":["count","cljs.core.async.impl.dispatch/queued?","cljs.core.async.impl.dispatch/tasks","cljs.core.async.impl.buffers/ring-buffer","cljs.core.async.impl.dispatch/running?","f","cljs.core.async.impl.dispatch/queue-dispatcher","goog/async.nextTick","cljs.core.async.impl.dispatch/process-messages","cljs.core.async.impl.dispatch/queue-delay","delay","m","js/setTimeout","cljs.core.async.impl.dispatch/TASK_BATCH_SIZE","cljs.core.async.impl.dispatch/run"],"sourcesContent":["(ns cljs.core.async.impl.dispatch\n  (:require [cljs.core.async.impl.buffers :as buffers]\n            [goog.async.nextTick]))\n\n(def tasks (buffers/ring-buffer 32))\n(def running? false)\n(def queued? false)\n\n(def TASK_BATCH_SIZE 1024)\n\n(declare queue-dispatcher)\n\n(defn process-messages []\n  (set! running? true)\n  (set! queued? false)\n  (loop [count 0]\n    (let [m (.pop tasks)]\n      (when-not (nil? m)\n        (m)\n        (when (< count TASK_BATCH_SIZE)\n          (recur (inc count))))))\n  (set! running? false)\n  (when (> (.-length tasks) 0)\n    (queue-dispatcher)))\n\n(defn queue-dispatcher []\n  (when-not (and queued? running?)\n    (set! queued? true)\n    (goog.async.nextTick process-messages)))\n\n(defn run [f]\n  (.unbounded-unshift tasks f)\n  (queue-dispatcher))\n\n(defn queue-delay [f delay]\n  (js/setTimeout f delay))\n\n"]}